
<!-- markdownlint-disable -->
# Kafka Multi Tenancy Demo
<!-- markdownlint-restore -->

[![README Header][readme_header_img]][readme_header_link]

<!--




  ** DO NOT EDIT THIS FILE
  **
  ** This file was automatically generated by the `build-harness`.
  ** 1) Make all changes to `README.yaml`
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file.
  **
  ** (We maintain HUNDREDS of open source projects. This is how we maintain our sanity.)
  **





-->
This repository serves as an example for managing multi-tenant Kafka clusters with Git and Flux v2.

---






## Usage

### Diagram
TODO




## Examples

### Getting Started
#### Requirements
* [Complete installation of demo cluster](https://github.com/osodevops/confluent-openshift-gitops-demo)
* [Flux CLI](https://fluxcd.io/docs/cmd/)
* [k9s](https://github.com/derailed/k9s) (optional but good idea)

### Repository structure
The [Confluent Openshift example](https://github.com/osodevops/confluent-openshift-gitops-demo) repository contains the following directory structure under the cluster-manifests:
  * ***clusters*** dir contains the Flux configuration per cluster 
  * ***operators*** dir contains common operators such as Confluent, CRDs and cluster-wide polices
    ```shell
      ├── cluster-manifests
      │   ├── clusters
      │   │   ├── development-ocp
      │   │   │   └── flux-system
      │   │   │       ├── gotk-components.yaml
      │   │   │       ├── gotk-sync.yaml
      │   │   │       ├── kustomization.yaml
      │   │   │       └── operators.yaml
      │   │   └── production-ocp
      │   │       └── flux-system
      │   │           ├── gotk-components.yaml
      │   │           ├── gotk-sync.yaml
      │   │           ├── kustomization.yaml
      │   │           └── operators.yaml
      │   └── operators
      │       ├── confluent.yaml
      │       ├── kustomization.yaml
      │       └── namespaces.yaml
      └── policy
      └── confluent-security-context.yaml
    ```
A [tenant repository](https://github.com/osodevops/confluent-openshift-team-alpha-resources) contains the following top directories for deploying Kafka in their own isolated namespace:
  * ***confluent*** dir contains Confluent component CRD manifests. Topology of the Kafka cluster you want to deploy 
  * ***connectors*** dir contains Kafka connectors with configuration / credentials in Confluent CRD format
  * ***topics*** dir contains all topics for current tenant in Confluent CRD format
    ```shell
      ├── confluent
      │   ├── ca-pair-sslcerts.yaml
      │   ├── connect-cluster.yaml
      │   ├── kafka.yaml
      │   ├── kustomization.yaml
      │   ├── schema-registry.yaml
      │   ├── tls-group1.yaml
      │   └── zookeeper.yaml
      ├── connectors
      │   ├── kustomization.yaml
      │   └── sample-connector.yaml
      ├── kustomization.yaml
      └── topics
      ├── foobar.yaml
      ├── gitops4lyfe.yaml
      └── kustomization.yaml
    ```  

### Onboarding new Kafka Tenants
Providing you have completed the steps of bootstrapping the cluster and have successfully deployed the Confluent operator you can now deploy any number of tenant isolated Kafka clusters. 
The Flux CLI offers commands to generate the Kubernetes manifests needed to define tenants with their RBAC permissions. Assuming the central Kafka admin wants to create a tenant named 
alpha-team with their apps having the ability to access Kafka in the same namespace:
  - Fork this repository and create the sync manifests for the tenant Git repository:
    ```shell
      flux create source git team-alpha-resources \
      --namespace=team-alpha \
      --url=https://github.com/<org>/<dev-team> \
      --branch=main \
      --export > ./tenants/base/team-alpha/sync.yaml
      
      flux create kustomization team-alpha-resources \
      --namespace=team-alpha \
      --service-account=team-alpha \
      --source=GitRepository/team-alpha-resources \
      --path="./" \
      --export >> ./tenants/base/team-alpha/sync.yaml
    ```  





## Related Projects

Check out these related projects.

- [Confluent for Kubernetes (CFK) examples](https://github.com/osodevops/confluent-kubernetes-playground) - Playground for Kafka / Confluent Kubernetes experimentations
- [Confluent Platform on Azure](https://github.com/osodevops/terraform-azure-confluent-platform) - Terraform module to deploy CP using supported Ansible scripts
- [Confluent Platform on AWS](https://github.com/osodevops/aws-terraform-module-confluent) - Terraform module to deploy CP using supported Ansible scripts
- [CP Ansible Docker](https://github.com/osodevops/docker-cp-ansible) - Docker wrapper to run CP Ansible on air gapped environments



## Need some help

File a GitHub [issue](https://github.com/osodevops/confluent-openshift-team-alpha-resources/issues), send us an [email][email] or [tweet us][twitter].

## The legals

Copyright © 2017-2021 [OSO](https://oso.sh) | See [LICENCE](LICENSE) for full details.

[<img src="https://oso-public-resources.s3.eu-west-1.amazonaws.com/oso-logo-green.png" alt="OSO who we are" width="250"/>](https://oso.sh/who-we-are/)

## Who we are

We at [OSO][website] help teams to adopt emerging technologies and solutions to boost their competitiveness, operational excellence and introduce meaningful innovations that drive real business growth. Our developer-first culture, combined with our cross-industry experience and battle-tested delivery methods allow us to implement the most impactful solutions for your business.

Looking for support applying emerging technologies in your business? We’d love to hear from you, get in touch by [email][email]

Start adopting new technologies by checking out [our other projects][github], [follow us on twitter][twitter], [join our team of leaders and challengers][careers], or [contact us][contact] to find the right technology to support your business.[![Beacon][beacon]][website]

  [logo]: https://oso-public-resources.s3.eu-west-1.amazonaws.com/oso-logo-green.png
  [website]: https://oso.sh?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=website
  [github]: https://github.com/osodevops?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=github
  [careers]: https://oso.sh/careers/?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=careers
  [contact]: https://oso.sh/contact/?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=contact
  [linkedin]: https://www.linkedin.com/company/oso-devops?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=linkedin
  [twitter]: https://twitter.com/osodevops?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=twitter
  [email]: mailto:enquiries@oso.sh?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=email
  [readme_header_img]: https://oso-public-resources.s3.eu-west-1.amazonaws.com/oso-animation.gif
  [readme_header_link]: https://oso.sh/what-we-do/?utm_source=github&utm_medium=readme&utm_campaign=osodevops/confluent-openshift-team-alpha-resources&utm_content=readme_header_link
  [beacon]: https://github-analyics.ew.r.appspot.com/G-WV0Q3HYW08/osodevops/confluent-openshift-team-alpha-resources?pixel&cs=github&cm=readme&an=confluent-openshift-team-alpha-resources
